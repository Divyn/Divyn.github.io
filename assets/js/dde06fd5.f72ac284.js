"use strict";(self.webpackChunkdivyasshree_portfolio=self.webpackChunkdivyasshree_portfolio||[]).push([[4293],{1345:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/hedgey-b1b7261aa7c1158dc610ea92e7dbce0d.png"},3082:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"Personal Blog/Web3/hedgey-exploit-6-months","title":"Hedgey Finance Exploit: Six Months Later, Lessons Learned, and Code Revamped","description":"On April 19, 2024, Hedgey Finance faced an exploit resulting in the loss of approximately $2 million on the Ethereum network, along with numerous BONUS tokens on the Arbitrum network.","source":"@site/docs/Personal Blog/Web3/hedgey-exploit-6-months.md","sourceDirName":"Personal Blog/Web3","slug":"/Personal Blog/Web3/hedgey-exploit-6-months","permalink":"/docs/Personal Blog/Web3/hedgey-exploit-6-months","draft":false,"unlisted":false,"editUrl":"https://github.com/divyn/divyn.github.io/edit/main/docs/Personal Blog/Web3/hedgey-exploit-6-months.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"The End of EOAs? How RIP-7212 Changes Everything","permalink":"/docs/Personal Blog/Web3/the-end-of-eoas-how-rip-7212-changes-ethereum"},"next":{"title":"CRM","permalink":"/docs/category/crm"}}');var a=i(4848),s=i(8453);const r={sidebar_position:2},o="Hedgey Finance Exploit: Six Months Later, Lessons Learned, and Code Revamped",l={},d=[{value:"Key Vulnerability and Attack Flow",id:"key-vulnerability-and-attack-flow",level:2},{value:"Impact Breakdown",id:"impact-breakdown",level:2},{value:"Timeline of Key Events",id:"timeline-of-key-events",level:2},{value:"Hedgey Finance\u2019s Response",id:"hedgey-finances-response",level:2},{value:"Impact on Redeem and Plan Creation Rates",id:"impact-on-redeem-and-plan-creation-rates",level:2},{value:"Code Fix and Updated cancelCampaign() Function",id:"code-fix-and-updated-cancelcampaign-function",level:2},{value:"Long-Term Effects and Community Sentiment",id:"long-term-effects-and-community-sentiment",level:2},{value:"Lessons Learned and Preventive Measures",id:"lessons-learned-and-preventive-measures",level:2},{value:"Conclusion",id:"conclusion",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"hedgey-finance-exploit-six-months-later-lessons-learned-and-code-revamped",children:"Hedgey Finance Exploit: Six Months Later, Lessons Learned, and Code Revamped"})}),"\n",(0,a.jsxs)(n.p,{children:["On April 19, 2024, ",(0,a.jsx)(n.a,{href:"https://medium.com/hedgey/hedgey-exploit-post-mortem-784e9860fd8d",children:"Hedgey Finance faced an exploit"})," resulting in the loss of approximately $2 million on the Ethereum network, along with numerous BONUS tokens on the Arbitrum network."]}),"\n",(0,a.jsxs)(n.p,{children:["This breach, due to a vulnerability in the ",(0,a.jsx)(n.a,{href:"https://vscode.blockscan.com/ethereum/0xBc452fdC8F851d7c5B72e1Fe74DFB63bb793D511",children:"ClaimCampaigns.sol contract"}),", highlighted the critical role of smart contract security and the need for contract audits of high-value audits."]}),"\n",(0,a.jsx)(n.p,{children:"This article revisits the incident 6 months later, analyzes the attack flow, and examines Hedgey Finance\u2019s response and the ongoing impact. We will also see the modifications made to the claim functionality."}),"\n",(0,a.jsx)(n.h2,{id:"key-vulnerability-and-attack-flow",children:"Key Vulnerability and Attack Flow"}),"\n",(0,a.jsx)(n.p,{children:"Vulnerable Contract: ClaimCampaigns.sol"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Contract Address: ",(0,a.jsx)(n.a,{href:"https://explorer.bitquery.io/ethereum/smart_contract/0xBc452fdC8F851d7c5B72e1Fe74DFB63bb793D511",children:"0xBc452fdC8F851d7c5B72e1Fe74DFB63bb793D511"})]}),"\n",(0,a.jsx)(n.li,{children:"Exploit Overview: The attacker exploited the createLockedCampaign() function, which lacked a mechanism to revoke token approvals after campaign cancellation. Consequently, the attacker could transfer funds by leveraging the transferFrom function, due to lingering token approvals."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Detailed Attack Flow"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Initiation: The attacker initiated a flash loan of 1.305 million USDC from Balancer as shown in the transaction flow below."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:i(1345).A+"",width:"1600",height:"658"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Approval Exploit: The attacker called the createLockedCampaign() function, granting themselves an approval to transfer USDC tokens."}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["We don\u2019t see this function now in the ClaimCampaigns.sol file which is now replaced with ",(0,a.jsx)(n.code,{children:"createUnlockedCampaign()"})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:i(7112).A+"",width:"1600",height:"1142"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Cancellation with Exploit:"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Within the same transaction, they called cancelCampaign(), withdrawing USDC without revoking the approval."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Execution of Transfer:"}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["In a follow-up transaction, ",(0,a.jsx)(n.a,{href:"https://explorer.bitquery.io/ethereum/tx/0xa17fdb804728f226fcd10e78eae5247abd984e0f03301312315b89cae25aa517/tracing",children:"they used transferFrom() to move 1,303,910 USDC out of the Hedgey Finance account."})]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://lh7-rt.googleusercontent.com/docsz/AD_4nXeCucLP_MKuGIdkncbPKDBtfplZ3ENADOkK30xzDG-_YgAX5kJYKa5bKs6LMgwopRHX4dkJM0Gd7DLT6w22U96WaVgz_JJJyiMFvY6_-GFWbKtAZE6FkYJ_CEO4UE6WzK_M89fibw?key=4txW0y9TvdjUk0Q0JjSepfYs",alt:""})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Repeat Exploit: The attacker repeated the process with BONUS tokens on Arbitrum, resulting in an additional loss of approximately $600,000."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Visualizing the Attack Flow"}),"\n",(0,a.jsx)(n.p,{children:"Here\u2019s a simplified flowchart detailing the exploitation process:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://lh7-rt.googleusercontent.com/docsz/AD_4nXf4fFKPzFknuWIEg_VylJEAzABq6VHm-y_I3toRhw3SQn6LdnEOqF0kkYJiJQhuB9NO05e1GkNFC00wDoBbSP0XCqUSLQTFbQwnLkqYGoez2WbcK3p9ZYdyQQNWcBB7icX_dGlVVQ?key=4txW0y9TvdjUk0Q0JjSepfYs",alt:""})}),"\n",(0,a.jsx)(n.p,{children:"Each of these steps involved manipulating the createLockedCampaign() and cancelCampaign() functions to gain control over Hedgey Finance\u2019s assets."}),"\n",(0,a.jsx)(n.h2,{id:"impact-breakdown",children:"Impact Breakdown"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Total Loss: $2 million USD in various tokens, with the largest single extraction at 1.3 million USDC."}),"\n",(0,a.jsx)(n.li,{children:"Additional Losses: Approximately $20,000 in MASA tokens and 78,148,820 BONUS tokens taken through similar exploits by copycat attackers."}),"\n",(0,a.jsx)(n.li,{children:"Identified Attackers: At least three attackers were involved, with one primary address executing most of the losses on Ethereum."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"timeline-of-key-events",children:"Timeline of Key Events"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"April 19, 2024: Initial exploit occurs; Hedgey loses $2 million."}),"\n",(0,a.jsx)(n.li,{children:"April 20, 2024 - Present: Hedgey Finance collaborates with cybersecurity firms to investigate and recover funds."}),"\n",(0,a.jsx)(n.li,{children:"Post-April 2024: Additional minor exploits by copycat attackers take a further $20,000 and 78 million BONUS tokens."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"hedgey-finances-response",children:"Hedgey Finance\u2019s Response"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Immediate Communication: - ",(0,a.jsx)(n.a,{href:"https://x.com/goforlindsey/status/1781605844192235738",children:"Lindsey Winder of Hedgey Finance swiftly addressed the community on social media, pledging action and transparency."})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Investigation and Collaboration: - Partnered with cybersecurity firms, law enforcement, and impacted entities to track and recover funds. ",(0,a.jsx)(n.a,{href:"https://x.com/hedgeyfinance/status/1785026046095466750",children:"Hedgey Finance kept users informed through regular updates."})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Security Enhancements: - Conducted multiple audits and implemented security improvements to prevent similar incidents. - Introduced white hat bounties to encourage vulnerability identification. - Developed Hedgey 2.0 with more robust security."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Community Support: - Supported impacted users by collaborating on token claim pages and providing regular updates, particularly to the NobleBlocks community."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"impact-on-redeem-and-plan-creation-rates",children:"Impact on Redeem and Plan Creation Rates"}),"\n",(0,a.jsx)(n.p,{children:"Redeem Activity Analysis"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Pre-Hack (April 1 - April 18): ",(0,a.jsx)(n.a,{href:"https://ide.bitquery.io/hedgey-redeemPlans-post-hack",children:"Average of 19.43 redeem plans per day."})]}),"\n",(0,a.jsx)(n.li,{children:"Post-Hack (April 19 onward): Average dropped to 7.62 redeems per day."}),"\n",(0,a.jsx)(n.li,{children:"Observation: The decline suggests a decrease in user confidence initially, though total post-hack redeems show a rebound over time."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Plan Creation Analysis"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Pre-Hack (April 1 - April 18): Average of 31.41 plans created per day."}),"\n",(0,a.jsx)(n.li,{children:"Post-Hack: Decreased slightly to 27.16 plans per day."}),"\n",(0,a.jsx)(n.li,{children:"Observation: While a drop is observed, total post-hack plan creation saw a recovery, indicating regained user confidence."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"code-fix-and-updated-cancelcampaign-function",children:"Code Fix and Updated cancelCampaign() Function"}),"\n",(0,a.jsx)(n.p,{children:"Hedgey Finance updated the cancelCampaign() function to prevent unauthorized token transfers after campaign cancellation. The updated code snippet now deletes campaign approvals and lockups before initiating the token transfer, ensuring any unclaimed tokens are returned to the campaign manager without leaving approvals vulnerable."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://lh7-rt.googleusercontent.com/docsz/AD_4nXd6gjZdneSkpJA_k10cj2dNWw72PfDAO7THY37pieXCFWIVTr6zI39Gl-QxzuV4f_GYMgfrxPyLUK6JeD89TO89jfgO0UGgUDG6f7lBYutWbbls_vvnaWKFgECi9f2zQlYUGAXk?key=4txW0y9TvdjUk0Q0JjSepfYs",alt:""})}),"\n",(0,a.jsx)(n.h2,{id:"long-term-effects-and-community-sentiment",children:"Long-Term Effects and Community Sentiment"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Reputation Impact: - Hedgey Finance\u2019s reputation suffered initially, but transparency in communication and a proactive response helped mitigate damage."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"User Trust and Activity: - User trust took a hit, as evidenced by reduced platform engagement in the immediate aftermath. However, Hedgey\u2019s efforts to support affected users and enhance platform security gradually restored confidence."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"lessons-learned-and-preventive-measures",children:"Lessons Learned and Preventive Measures"}),"\n",(0,a.jsx)(n.p,{children:"Key Recommendations for DeFi Developers"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Revoke Approvals: Always revoke token approvals in contracts once they are no longer needed."}),"\n",(0,a.jsx)(n.li,{children:"Use Secure ERC20 Implementations: Secure implementations from trusted sources like OpenZeppelin are essential."}),"\n",(0,a.jsx)(n.li,{children:"Multi-Sig Wallets: Implement multi-signature wallets for sensitive transactions to prevent unauthorized access."}),"\n",(0,a.jsxs)(n.li,{children:["Audits and Testing: ",(0,a.jsx)(n.a,{href:"https://www.quillaudits.com/blog/smart-contract/smart-contract-audit",children:"Comprehensive audits"})," and rigorous testing can identify and mitigate vulnerabilities before deployment."]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"User Education"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Users should regularly review and revoke token permissions, avoid unaudited projects, and consider hardware wallets for additional security."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsx)(n.p,{children:"The Hedgey Finance exploit underscored the necessity of thorough security protocols in DeFi platforms. Hedgey\u2019s swift response, including increased security measures, transparent communication, and community engagement, has fostered a sense of renewed confidence. This incident serves as a critical reminder for all stakeholders in the DeFi ecosystem about the importance of continuous auditing, user education, and proactive vulnerability management."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},7112:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/createUnlockedCampaign-da22851f518422c38f4c41bafea91273.png"},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var t=i(6540);const a={},s=t.createContext(a);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);